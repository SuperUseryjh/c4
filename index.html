<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Number</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="login-container">
        <h1>Login</h1>
        <input type="text" id="username-input" placeholder="Enter username">
        <button id="login-button">Login</button>
    </div>

    <div id="game-container" style="display:none;">
        <h1>Guess the Number (1-100)</h1>
        <p>Current Score: <span id="score-display">0</span></p>
        <input type="number" id="guess-input" min="1" max="100" placeholder="Your guess">
        <button id="guess-button">Guess</button>
        <p id="message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginContainer = document.getElementById('login-container');
            const gameContainer = document.getElementById('game-container');
            const usernameInput = document.getElementById('username-input');
            const loginButton = document.getElementById('login-button');
            const scoreDisplay = document.getElementById('score-display');
            const guessInput = document.getElementById('guess-input');
            const guessButton = document.getElementById('guess-button');
            const messageElement = document.getElementById('message');

            let sessionId = null;

            loginButton.addEventListener('click', async () => {
                const username = usernameInput.value.trim();
                if (username) {
                    try {
                        const response = await fetch('/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ username })
                        });
                        const data = await response.json();
                        if (response.ok) {
                            sessionId = data.sessionId;
                            loginContainer.style.display = 'none';
                            gameContainer.style.display = 'block';
                            messageElement.textContent = `Welcome, ${username}!`;
                            // In a real app, you'd fetch the initial score here
                        } else {
                            messageElement.textContent = `Login failed: ${data.error || response.statusText}`;
                        }
                    } catch (error) {
                        messageElement.textContent = `Error during login: ${error.message}`;
                    }
                } else {
                    messageElement.textContent = 'Please enter a username.';
                }
            });

            guessButton.addEventListener('click', async () => {
                const guess = parseInt(guessInput.value);
                if (isNaN(guess) || guess < 1 || guess > 100) {
                    messageElement.textContent = 'Please enter a valid number between 1 and 100.';
                    return;
                }

                if (!sessionId) {
                    messageElement.textContent = 'Please log in first.';
                    return;
                }

                try {
                    const response = await fetch('/guess', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId, guess })
                    });
                    const data = await response.json();

                    if (response.ok) {
                        if (data.correct) {
                            messageElement.textContent = `Correct! The number was ${data.targetNumber}. Your score is now ${data.newScore}.`;
                            scoreDisplay.textContent = data.newScore;
                        } else {
                            messageElement.textContent = `Wrong! The number was ${data.targetNumber}. Try again.`;
                        }
                    } else {
                        messageElement.textContent = `Guess failed: ${data.error || response.statusText}`;
                    }
                } catch (error) {
                    messageElement.textContent = `Error during guess: ${error.message}`;
                }
                guessInput.value = '';
            });
        });
    </script>
</body>
</html>
